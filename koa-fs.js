
const Koa = require('koa');
const app = new Koa();
const bodyParser = require('koa-bodyparser');
const util = require('util');
const http = require('http');
const fs = require('fs');
const mime = require('mime');

let _server ='';

let myBase64 ='AAABAAEAQEAAAAEAIAAoQgAAFgAAACgAAABAAAAAgAAAAAEAIAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAABYAAAAqAAAAOgAAAEwAAABcAAAAcgAAAHYAAAB2AAAAdgAAAHYAAAB2AAAAYgAAAFgAAABAAAAAMgAAAB4AAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAEgAAAEgAAAB6AAAAqwICAtMEBATlBgYG8RsbG/sxMTH/PT09/1RUVP9UVFT/VFRU/1RUVP9UVFT/VFRU/0RERP84ODj/Hh4e/wgICPUEBATrAgIC3QAAAMEAAACXAAAAZgAAAC4AAAAIAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAD4AAACJAAAAzRAQEPkxMTH/XV1d/46Ojv+3t7f/2tra//b29v/////////////////////////////////////////////////////////////////9/f3/4eHh/8HBwf+cnJz/b29v/0FBQf8dHR3/BAQE7wAAALMAAABuAAAAKgAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAiwAAANkYGBj7ZGRk/6mpqf/a2tr/+Pj4///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+/v7/5+fn/8XFxf+Hh4f/QEBA/wYGBvMAAAC1AAAASgAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAEAAAAC5FBQU+VhYWP++vr7/9/f3//7+/v////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////z8/P/h4eH/e3t7/xwcHP0AAAC/AAAANgAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALgAAALMWFhb7e3t7/9vb2//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////i4uL/bW1t/wcHB/EAAAB+AAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAfAkJCfFsbGz/5OTk//7+/v////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////z8/P+8vLz/JCQk/QAAAK8AAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAtywsLP++vr7//v7+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+Xl5f9BQUH/AAAAxwAAAB4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAeAQEBzUtLS//m5ub/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////7u7u/0pKSv8AAADJAAAAFgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAzVxcXP/19fX////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////09PT/S0tL/wAAALkAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAnUJCQv/x8fH//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+fn5/8qKir9AAAAiwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAThUVFfvl5eX/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////y8vL/xAQEP0AAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgEBAceMjIz//v7+//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////7+/v+Ghob/AAAAywAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADYbGxv36urq////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/f3/ygoKP8AAABoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4WVlZ///////////////////////////////////////39/f/ra2u//v7+//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////j4+T/mpqc//z8/P///////////+Li4v/d3d7///////////////////////////////////////////+ioqL/AgIC1QAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAp5SUlP/////////////////////////////////+/v7/hoaI/21tcP/+/v7//////9jY2f9fX2L/MDA1/6KipP//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////jY2P/wkJDv+np6n//v7+///////z8/P/TU1R/9TU1f//////////////////////////////////////8PDw/yUlJfsAAABIAAAAAAAAAAAAAAAAAAAABAAAAMG0tLT/////////////////////////////////39/f/xsbIP++vr///////+fn5/8hISX/BAQJ/wcHDP/Pz8///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////52dn/8EBAn/Ghoe/9/f3////////////5mZm/9UVFj//Pz8//////////////////////////////////////92dnb/AAAAmQAAAAAAAAAAAAAAAAAAAAQAAADDuLi4/////////////////////////////////5iYmv8qKi7/+vr7//////+NjY//BAQJ/wQECf8xMTX/9PT1///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////a2tv/EREW/wQECf9QUFP/9/f3///////o6Oj/Hh4i/+Dg4f//////////////////////////////////////v7+//wAAANMAAAAIAAAAAAAAAAAAAAACAAAAs6SkpP////////////////////////////////9bW1//fX2A////////////UlJV/wQECf8FBQr/mJia/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////2dnav8EBAn/BQUK/4uLjv///////v7+/1xcYP+enqD//////////////////////////////////////+zs7P8MDAz5AAAAFAAAAAAAAAAAAAAAAAAAAJN7e3v/////////////////////////////////QUFF/7Kys////////////0ZGSv8GBgv/Xl5i//j4+P//////8vLz/7W1t/////////////////////////////////////////////////////////////////////////////////////////////////////////////////+5ubr/9PT0///////o6Oj/Ojo+/wQECf84ODz///////////+VlZf/fX2A///////////////////////////////////////z8/P/JCQk/wAAACoAAAAAAAAAAAAAAAAAAABaPDw8//39/f///////////////////////////1FRVP+ioqT////////////U1NX/1tbX//39/f//////7Ozs/1NTVv/e3t//////////////////////////////////////////////////////////////////////////////////////////////////////////////////m5ud/2VlaP/6+vv///////T09P+2trf/6Ojo////////////qamq/4mJi///////////////////////////////////////+fn5/zg4OP8AAAA+AAAAAAAAAAAAAAAAAAAAIBAQEPPb29v///////////////////////////96en3/U1NW////////////////////////////9vb2/15eYf+Kioz//v7+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////+7u7/9FRUn/kZGT//39/f///////////////////////////4iIiv+6urv///////////////////////////////////////X19f8qKir/AAAALgAAAAAAAAAAAAAAAAAAAAAAAACziIiI//7+/v//////////////////////0NDR/xgYHf+9vb7//v7+////////////9/f3/3R0d/9JSUz/9fX1////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////6Ojp/z4+Qv+ampz/+/v7/////////////////9ra2/9LS0//9fX2///////////////////////////////////////s7Oz/Dw8P+wAAABYAAAAAAAAAAAAAAAAAAAAAAAAATCAgIP309PT///////////////////////39/v+OjpD/KCgt/6mpq//Jycv/rq6w/1BQVP9LS07/5eXm///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////r6+z/Z2dq/2lpbP+/v8D/ycnL/4+Pkf9CQkX/xcXG////////////////////////////////////////////vb29/wAAANUAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAoAAADDjY2N//7+/v///////////////////////f39/7u7vP9jY2b/TExQ/2Zmaf+ysrT/9vb2//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////v7+//IyMn/dXV4/1lZXP+Dg4b/4uLi/////////////////////////////////////////////v7+/2ZmZv8AAACPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQBcXF/vb29v//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9TU1P8QEBDzAAAALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAChUlJS//z8/P////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////v7+/9JSUn/AAAAlQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGgICAtmSkpL//f39//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////b29v9iYmL/AAAAyQAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGDw8P98LCwv////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Hx8f9gYGD/AgIC2wAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHIfHx/72dnZ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+vr6/7+/v/8wMDD9AAAAvQAAAB4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAlzIyMv/o6Oj/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////zc3N/1JSUv8HBwftAAAAfAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAADXt7e3/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////21tbf8AAAC5AAAAIgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAA4d7e3v////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////99fX3/AAAAjwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHgoKCvf4+Pj///////////////////////////////////////////////////////7+/v/7+/v/+/v7///////////////////////////////////////////////////////////////////////////////////////9/f3//Pz8//7+/v//////////////////////////////////////////////////////fX19/wAAAI8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC4iIiL/+/v7///////////////////////////////////////////////////////W1tf/Kysw/y8vM//U1NX////////////////////////////////////////////////////////////////////////////4+Pj/a2tu/0NDR//c3Nz//////////////////////////////////////////////////////319ff8AAACPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA6Li4u//v7+///////////////////////////////////////////////////////YGBj/wQECf8EBAn/VVVY//z8/P//////////////////////////////////////////////////////////////////////ra2v/wcHDP8EBAn/W1te//////////////////////////////////////////////////////99fX3/AAAAjwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOi4uLv/7+/v//////////////////////////////////////////////////////zc3O/8EBAn/BAQJ/xERFv/y8vL//////////////////////////////////////////////////////////////////f39/1ZWWf8EBAn/BAQJ/yoqL//z8/T/////////////////////////////////////////////////a2tr/wAAAHgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADYqKir/+/v7//////////////////////////////////////////////////////9TU1b/BAQJ/wQECf8FBQr/8PDw//////////////////////////////////////////////////////////////////j4+P8wMDT/BAQJ/wQECf8sLDD/9fX1/////////////////////////////////////////////////09PT/8AAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgERER+/n5+f//////////////////////////////////////////////////////s7O0/wcHDP8EBAn/LS0y//f39//////////////////////////////////////////////////////////////////4+Pj/MjI2/wQECf8EBAn/Wlpd//7+/v////////////////////////////////////////////b29v8sLCz9AAAAOgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAOXm5ub///////////////////////////////////////////////////////39/f+FhYj/MjI2/62tr////////////////////////////////////////////////////////////////////////v7+/5iYmv8iIib/MjI2/9fX2P/////////////////////////////////////////////////Y2Nj/DAwM9QAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAADHsrKy/////////////////////////////////////////////////////////////f39//Pz8//+/v7////////////////////////////////////////////////////////////////////////////9/f3/7Ozt//Ly8v/+/v7/////////////////////////////////////////////////l5eX/wAAAL8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAt3BwcP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////z4+Pv8AAACnAAAAGgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAB8AAAA5S0tLf+bm5v///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+ampr/NDQ0/wAAAOUAAACFAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAADDMjIy/7y8vP/9/f3///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////7+/v/AwMD/Pz8//wEBAc8AAAAaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAADPV1dX/+3t7f////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Dw8P9TU1P/AAAAqwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAACTSEhI//T09P//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////6Ojo/xgYGPkAAABCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAiBQUF8dXV1f////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/f3//AAAArwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZkdHR//+/v7//////////////////////////////////////////////////////+rq6v/39/f///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////r6+v/+/v7/////////////////////////////////////////////////0dHR/wUFBe0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJF+fn7//////////////////////////////////////////////////////9nZ2f8lJSX/Nzc3/5ubm//n5+f//v7+////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+vr6/7e3t/9KSkr/zs7O/////////////////////////////////////////////////97e3v8NDQ37AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACbiIiI//////////////////////////////////////////////////X19f86Ojr/AAAAnQAAAHABAQHXGRkZ/V5eXv+srKz/7+/v//z8/P/////////////////////////////////////////////////////////////////////////////////////////////////6+vr/u7u7/0RERP8HBwftAAAAyUtLS//4+Pj////////////////////////////////////////////MzMz/AQEB4QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAeGJiYv/+/v7///////////////////////////////////////v7+/9ubm7/AAAAwQAAAAwAAAAAAAAAAgAAADwAAACPAAAA0QoKCvU8PDz/dnZ2/6qqqv/S0tL/6Ojo//n5+f/////////////////////////////////////////////////8/Pz/6enp/87Ozv+MjIz/LS0t/wAAAOEAAACDAAAAGAAAABICAgLfnZ2d////////////////////////////////////////////i4uL/wAAAK8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAcHBz9+vr6//////////////////////////////////////+srKz/BwcH7wAAACoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAuAAAAZAAAAJ8AAADPCAgI9x0dHf8uLi7/RkZG/19fX/9tbW3/goKC/4KCgv+CgoL/fn5+/2hoaP9SUlL/NTU1/x4eHv8HBwfzAAAAvQAAAGIAAAAaAAAAAAAAAAAAAAAAAAAAWBgYGPvg4OD//////////////////////////////////////zk5Of8AAABkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAA0aOjo/////////////////////////////7+/v/Ly8v/FRUV9wAAAFYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAqAAAATAAAAGgAAACBAAAAjQAAAKUAAAClAAAApQAAAJ0AAACJAAAAdAAAAFgAAAAuAAAACAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAACVPz8//+/v7////////////////////////////8XFxf8GBgblAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFgiIiL/3Nzc///////////////////////R0dH/ICAg/QAAAIEAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAMVZWVn/9PT0//////////////////j4+P9NTU3/AAAAjwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAnywsLP2+vr7/6Ojo/9bW1v9+fn7/ExMT9wAAAIUAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAQEByUZGRv/X19f/9vb2/+fn5/9qamr/AgIC1wAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoAAACBAAAA3wsLC/UAAADnAAAAtQAAAEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABYAAACdCwsL9zY2Nv8XFxf9AAAAvwAAACgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAcAAAAFgAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAACoAAABSAAAANgAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA///////////////////////////////////////////////////////////////////8AAAf/////4AAAAH////8AAAAAD////AAAAAAD///wAAAAAAH//+AAAAAAAH//gAAAAAAAP/8AAAAAAAAf/gAAAAAAAA/8AAAAAAAAB/wAAAAAAAAH+AAAAAAAAAP4AAAAAAAAA/gAAAAAAAAB8AAAAAAAAAHwAAAAAAAAAPAAAAAAAAAA8AAAAAAAAADwAAAAAAAAAPgAAAAAAAAA+AAAAAAAAAD4AAAAAAAAAPwAAAAAAAAA/AAAAAAAAAD+AAAAAAAAAf4AAAAAAAAB/wAAAAAAAAP/gAAAAAAAB//AAAAAAAAP/8AAAAAAAD//4AAAAAAAf//gAAAAAAB//+AAAAAAAH//4AAAAAAAf//gAAAAAAB//+AAAAAAAP//4AAAAAAA///gAAAAAAD//+AAAAAAAP//4AAAAAAA///gAAAAAAD//8AAAAAAAD//AAAAAAAAH/4AAAAAAAAP/AAAAAAAAA/8AAAAAAAAB/wAAAAAAAAH+AAAAAAAAAf4ABAAAAAAB/wAPAAAAYAH/AB/wAAPwA/8AP//Af/AD/4A/////+AP/gH/////8B//B//////4P////////////////////////////////8=';

// app.use(bodyParser());
//  image/x-icon

// let _readfile = './public/beautyGirl/1.jpg';
let _readfile = './public/dhmauto_64x64.ico';

const stat = util.promisify(fs.stat);
const readfile = util.promisify(fs.readFile);
const readdir = util.promisify(fs.readdir);
const relpath = util.promisify(fs.realpath);


const preadfile = (file,encoding ='utf-8') => {
  let _pread= new Promise((resolve, reject) => {
    // let file = readfile(file,encoding);
    resolve(readfile(file,encoding));
  });
    
  return _pread
    .then(
      (data) => {
        // console.log('then 1');
        return data;
      },
      (err) => {
        console.log('err at then 1');
        throw err;
      })
    .then(
      (data) => {
        console.log('then2');
        return data;
      }
    )
    .catch(
      (err) => {
        // console.error(err);
        console.log('find err at preadfile');
        throw err;
      }
    );

  // return _pread;
  
};

const preaddir = (dir) => {
  return new Promise((resolve, reject) => {
    resolve(relpath(dir));
  }).catch((err) => {
    //reject(err);
    // console.error(err);
    // throw new Error(err)
    console.log('find err at readdir');
    return err;
  });
};


app.use(async (ctx,next)=>{
  console.log(`Process ${ctx.request.method} ${ctx.request.url}...`);
  
  let url = ctx.request.url;

  if (url==='/') {
    ctx.body= `<h1>hello ${url}</h1>
    ctx.request.ip : ${ctx.request.ip}</br>
    ctx.request.hostname : ${ctx.request.hostname}</br>
    `;
    return ;
  } 
  
  if(url==='/favicon.ico'){
    try {
      // let data = await next();
      let data = await preadfile(_readfile,'binary');
      console.log(
        `typeof stats : ${typeof data}
        stats is error : ${util.isError(data)}
        ctx.request.hostname ï¼š ${ctx.request.hostname}
        `);
      // let imgBase64 = Buffer.from(data,'binary').toString('base64');
      ctx.response.status = 200;
      ctx.response.type = mime.getType('ico');
      ctx.res.write(data,'binary');
      ctx.res.end();

    } catch (err) {
      console.log('find err at async 1');
      throw err;
    }
    return ;
  }

  await next();
  /*
  try {
    
    let binData = Buffer.from(myBase64,'base64');
    console.log( mime.getType('ico'));
    // console.log(binData);
    // ctx.response.type = mime.getType(_readfile);
    // ctx.response.set('content-type','image/jpg');
    // ctx .response.attachment('hello.jpg');
    ctx.res.write(binData,'binary');
    ctx.res.end();

    ctx.body = `
    <img src="data:image/ico;base64,${myBase64}">
    <img src="data:image/ico;base64,${imgBase64}" style="width:300px;">
    <textarea rows="10" cols="80">${imgBase64}</textarea>`; 
    
  } catch (error) {
    console.log('find err at async 1');
    throw error;
  } 
  */
 
});


app.use(async (ctx,next)=>{
  await next();
  // return await preadfile(_readfile,'binary');
  // return await preaddir('../koa_2.2/');
});

app.use(async (ctx,next) => {
  console.log('hi,im end :' + mime.getType(_readfile));
});

app.on('error',(err,ctx)=>{
  console.log('find err app on error:');
  console.error(err);
});

let server = http.createServer(app.callback());
let _port = process.env.PORT || 3001 ;
server.listen(_port);




/* 
//bind exception event to log
process.on('uncaughtException', function (e) {
  console.log('uncaughtException from process', e);
});
process.on('unhandledRejection', (e) => {
  console.log('unhandledRejection from process', e);
});
process.on('rejectionHandled', (e) => {
  console.log('rejectionHandled from process', e);
});


app.listen(3000,'localhost',(req,res) => {
  console.log(util.inspect(app,{ showHidden: true, depth: null }));
}); 

app.listen(3000,'localhost',function (params) {
  _server = this;
  this.timeout = 110000;
  this.keepAliveTimeout = 4000;
  
  let that = this;
  console.log(util.inspect(that));
   
  // return this;
});


*/